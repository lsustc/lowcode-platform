(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56605d46"],{"0780":function(e,t,s){},"2e38":function(e,t,s){"use strict";s("0780")},"8f20":function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("li",{staticClass:"select2-results-dept-0 select2-result select2-result-selectable",attrs:{role:"presentation"}},[t("div",{staticClass:"select2-result-label",attrs:{id:"select2-result-label-25",role:"option"}},[t("div",{staticClass:"user-result undefined"},[t("div",{staticClass:"user-image"},[t("img",{staticClass:"avatar s24",attrs:{src:e.item.photo}})]),t("div",{staticClass:"user-name"},[e._v(e._s(e.item.name))])])])])},r=[],n={mixins:[],name:"CUser_Item",props:{item:Object,default:function(){return{name:"",email:"",photo:""}}},data:function(){return{}},methods:{}},o=n,i=(s("2e38"),s("2877")),l=Object(i["a"])(o,a,r,!1,null,"f1fa7018",null);t["a"]=l.exports},"9bff":function(e,t,s){"use strict";s("ce24")},ce24:function(e,t,s){},e351:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{},[t("div",{staticClass:"flash-container flash-container-page"}),t("div",{staticClass:"container-fluid container-limited"},[t("div",{staticClass:"content"},[t("div",{staticClass:"project-members-page prepend-top-default"},[e.role<=2?t("div",{staticClass:"panel panel-default"},[t("div",{staticClass:"panel-heading"},[e._v("\n            添加用户到项目\n          ")]),t("div",{staticClass:"panel-body"},[t("p",{staticClass:"light"},[e._v("\n              下面列举的是可以访问项目的所有用户\n            ")]),t("el-form",{attrs:{"label-width":"80px"}},[t("el-form-item",{attrs:{label:"账号"}},[t("el-select",{staticClass:"searchUser",attrs:{multiple:"",filterable:"",remote:"",placeholder:"请输入关键词","remote-method":e.querySearchAsync},model:{value:e.req.userId,callback:function(t){e.$set(e.req,"userId",t)},expression:"req.userId"}},e._l(e.searchUsers,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name+e.email,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"权限"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.req.role,callback:function(t){e.$set(e.req,"role",t)},expression:"req.role"}},e._l(e.projectPower,(function(e,s){return t("el-option",{key:s,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",disabled:!e.req.role||!e.hasAddUser},on:{click:e.onSubmit}},[e._v("添加用户到项目")])],1)],1)],1)]):e._e(),t("div",{staticClass:"panel panel-default"},[t("div",{staticClass:"panel-heading"},[t("strong",[e._v(e._s(e.info.projectName))]),t("span",{staticClass:"badge"},[e._v(e._s(e.pusers.length))])]),t("ul",{staticClass:"content-list"},e._l(e.pusers,(function(s,a){return t("li",{key:a,staticClass:"group_member js-toggle-container"},[t("div",{staticClass:"controls"},[e.role<=2?t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v("\n                    "+e._s(e._f("projectRole")(s.role))),t("i",{staticClass:"el-icon-caret-bottom el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.projectPower,(function(a){return t("el-dropdown-item",{key:a.value,attrs:{trigger:"click",command:a.value+","+s.userId}},[e._v(e._s(a.label)+"\n                    ")])})),1)],1):[e._v("\n                  "+e._s(e._f("groupRole")(s.role))+"\n                ")],s.userId===e.userInfo.userId?t("a",{staticClass:"btn btn-remove",on:{click:function(t){return e.remove(s,!0)}}},[e._v("离开")]):e._e(),s.userId!=e.userInfo.userId&&e.info.role<=2?t("a",{staticClass:"btn btn-remove",on:{click:function(t){return e.remove(s)}}},[e._v("移除")]):e._e()],2),t("span",{staticClass:"list-item-name"},[t("img",{staticClass:"avatar s40",attrs:{alt:"",src:e._f("defaultHeader")(s.photo)}}),t("strong",[t("router-link",{attrs:{to:{path:"/user",query:{id:s.userId}}}},[e._v(e._s(s.name))])],1),s.userId===e.userInfo.userId?t("span",{staticClass:"label label-success"},[e._v("当前用户")]):e._e(),t("div",{staticClass:"cgray"},[e._v(e._s(s.email))])])])})),0)]),t("div",{staticClass:"panel panel-default"},[t("div",{staticClass:"panel-heading"},[t("strong",[e._v(e._s(e.info.groupName))]),t("span",{staticClass:"badge"},[e._v(e._s(e.gusers.length))])]),t("ul",{staticClass:"content-list"},e._l(e.gusers,(function(s,a){return t("li",{key:s.userId,staticClass:"group_member js-toggle-container"},[t("span",{staticClass:"list-item-name"},[t("img",{staticClass:"avatar s40",attrs:{alt:"",src:e._f("defaultHeader")(s.photo)}}),t("strong",[t("router-link",{attrs:{to:{path:"/user",query:{id:s.userId}}}},[e._v(e._s(s.name))])],1),s.userId===e.userInfo.userId?t("span",{staticClass:"label label-success"},[e._v("当前用户")]):e._e(),t("div",{staticClass:"cgray"},[e._v(e._s(s.email))]),t("div",{staticClass:"cgray"},[e._v(e._s(e._f("projectRole")(s.role)))])])])})),0)])])])])])},r=[],n=s("f458"),o=s("c455"),i=s("8f20"),l=s("5880"),c=s("8bbf"),u=s.n(c);u.a.component("my-item-zh",{functional:!0,render:function(e,t){return e("li",t.data,[e(i["a"],{props:{item:t.props.item}})])},props:{item:{type:Object,required:!0}}});var d={mixins:[n["a"]],components:{},name:"projects_members",props:{id:{type:String}},data:function(){return{searchUsers:[],info:{},req:{projectId:"",role:"",userId:""},value:"",pusers:[],gusers:[]}},mounted:function(){this.req.projectId=this.id,this.loadData()},computed:Object(l["mapState"])({Metadata:function(e){return e.Metadata},projectPower:function(e){return e.Metadata.projectPower.filter((function(e){return 1!=e.value}))},hasAddUser:function(){return this.req.userId.length>0},role:function(){var e=this,t=100;return this.pusers.forEach((function(s){s.userId==e.userInfo.userId&&(t=Math.min(t,s.role))})),this.gusers.forEach((function(s){s.userId==e.userInfo.userId&&(t=Math.min(t,s.role))})),t},canLeave:function(){return!0}}),methods:{querySearchAsync:function(e,t){var s=this;""!=e&&Object(o["a"])({url:"users/search",method:"get",params:{key:e}}).then((function(e){var t=s.pretreatmentList(e.data.data);s.searchUsers=t})).catch((function(){}))},pretreatmentList:function(e){var t=[];return e.forEach((function(e){t.push({value:e.name,email:e.email,name:e.name,photo:e.photo,id:e.id})})),t},loadData:function(){var e=this;Object(o["a"])({url:"project/projectuser",method:"get",params:{count:100,projectId:this.req.projectId,start:0}}).then((function(t){e.pusers=t.data.data})),Object(o["a"])({url:"project/projectinfo",method:"get",params:{id:this.req.projectId}}).then((function(t){e.info=t.data.data;var s=e;Object(o["a"])({url:"project/groupuser",method:"get",params:{count:100,id:e.info.groupId,start:0}}).then((function(e){s.gusers=e.data.data}))}))},handleCommand:function(e){var t=this,s=e.split(",")[0],a=e.split(",")[1];Object(o["a"])({url:"project/projectuser",method:"put",data:{projectId:this.req.projectId,role:s,userId:a}}).then((function(e){t.$message("修改成功"),t.loadData()})).catch((function(){}))},onSubmit:function(){var e=this;Object(o["a"])({url:"project/projectuser",method:"post",data:this.req}).then((function(t){e.$message("添加成功"),e.loadData()})).catch((function(){}))},remove:function(e){var t=this;Object(o["a"])({url:"project/projectuser",method:"delete",data:{projectId:this.req.projectId,userId:e.userId}}).then((function(s){t.$message("删除成功"),e.userId===t.userInfo.userId?t.$router.push({path:"/dashboard/groups"}):t.loadData()})).catch((function(){}))}}},p=d,m=(s("9bff"),s("2877")),f=Object(m["a"])(p,a,r,!1,null,"84a475f4",null);t["default"]=f.exports}}]);