(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16e201e2"],{2747:function(t,e,n){"use strict";var i=n("f7ab"),a=n.n(i),o=n("5880");e["a"]={replace:!0,data:function(){return{title:"",size:"small",Visible:!0}},computed:Object(o["mapState"])({Config:function(t){return t.Config},RootNodeInfo:function(t){return t.RootNodeInfo},Metadata:function(t){return t.Metadata},demoMode:function(t){return t.setting.demoMode}}),beforeCreated:function(){},created:function(){this.ema=a.a.getProxy()},beforeMount:function(){},mounted:function(){},beforeUpdate:function(){},updated:function(){},activated:function(){},deactivated:function(){},beforDestroy:function(){},destroyed:function(){this.ema.dispose()},methods:{bindEvent:function(t,e){this.$options.name||console.warn("绑定事件的组件不存在组件名称",t),this.ema.bind("".concat(this.$options.name,".").concat(t),e)},openDialog:function(t){this.ema.fire("Dialogs.push",t)},close:function(){this.ema.fire("Dialogs.close",this.$options.name)}}}},"36e1":function(t,e,n){},9761:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"psd_dialog",class:{service:t.asService},attrs:{"element-loading-text":"拼命解析中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)",title:t.title,width:"50%",center:!0,visible:t.Visible,modal:!0},on:{"update:visible":function(e){t.Visible=e},close:t.close}},[n("div",{staticClass:"wraper"},[n("span",[t._v("上传PSD文件")]),n("input",{ref:"input",attrs:{type:"file",id:"aptitude",accept:".psd"},on:{change:t.change}})]),n("div",{staticClass:"tips"},[n("section",{staticClass:"desc"},[n("h4",[t._v("上传须知")]),n("ol",[n("li",{attrs:{_tracker_click_:"_tracker_click_"}},[t._v(" 为保证上传速度，PSD文件大小不超过"),n("span",[t._v("30M")]),t._v("，图层不能超过"),n("span",[t._v("30个")]),t._v("，且每个图层不能够超过"),n("span",[t._v("5M")]),t._v("。")]),n("li",{attrs:{_tracker_click_:"_tracker_click_"}},[t._v(" 必须使用"),n("span",{staticStyle:{color:"red"}},[t._v("RGB/8")]),t._v("通道模式, 为保证图片质量，建议上传前尽量将效果合并至图层中。")])])])])])},a=[],o=n("a34a"),s=n.n(o),r=n("2747"),c=n("c455");function l(t,e,n,i,a,o,s){try{var r=t[o](s),c=r.value}catch(l){return void n(l)}r.done?e(c):Promise.resolve(c).then(i,a)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var o=t.apply(e,n);function s(t){l(o,i,a,s,r,"next",t)}function r(t){l(o,i,a,s,r,"throw",t)}s(void 0)}))}}var u={mixins:[r["a"]],name:"d-psd",components:{},data:function(){return{asService:!1,loading:!1,env:"production",nodeTree:{id:"truck/imageid",type:"truck/image",label:"图片id",version:"0.1.10",url:"https://ymm-maliang.oss-cn-hangzhou.aliyuncs.com/truck/image/0.1.10/index.js",visible:!0,style:{position:"absolute",width:"313px",height:"226px",left:"3.453125px",top:"0px",opacity:1},props:{url:"",mode:"widthFix",click:[]},path:"https://ymm-maliang.oss-cn-hangzhou.aliyuncs.com/truck/image/0.1.10/index.js",script:[],stack:!0,childLimit:9999,animate:[],events:[]},content:[],psdFile:"",psdSize:"",psdUrl:"",psdName:"",root:""}},mounted:function(){this.asService&&/https?:\/\//.test(this.psdUrl)&&this.change({})},computed:{},methods:{uptoServer:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,i=void 0===n?"file":n,a=e.content;return console.log("type",i,"content",a),"file"===i?(t=new window.FormData,t.append("file",a)):"url"===i&&(t={url:a}),Object(c["a"])({url:"editor/pages/psd-to-page",method:"post",needLoading:!1,data:t})},change:function(){var t=d(s.a.mark((function t(){var e,n,i,a,o,r,c,l,d,u,p,h,f,g,m=this;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.asService){t.next=14;break}if(n=this.$refs.input.files,console.log("file",n),n[0]){t.next=5;break}return t.abrupt("return");case 5:if(i=(n[0].size/1024/1024).toFixed(2),!(i>30)){t.next=8;break}return t.abrupt("return",this.$alert("psd文件不能大于30M"));case 8:this.psdFile=n[0],this.psdSize=i,this.psdName=n[0].name,e={type:"file",content:n[0]},t.next=15;break;case 14:e={type:"url",content:this.psdUrl};case 15:return this.loading=!0,t.next=18,this.uptoServer(e).catch((function(t){m.loading=!1,m.close(),console.log(t&&t.message||"解析失败")}));case 18:if(a=t.sent,a){t.next=21;break}return t.abrupt("return");case 21:o=window.$_nodecomponents[this.root||"root"],r=o&&o.$el?o.$el.getBoundingClientRect().width:320,t.prev=23,c=a.data.data,l=c.document.width,d=r/l,u=c.elements||[],p=[],t.next=35;break;case 31:return t.prev=31,t.t0=t["catch"](23),this.loading=!1,t.abrupt("return",this.$alert(a.data.msg));case 35:if(0!=u.length){t.next=39;break}return this.loading=!1,this.$alert("未发现图层,请检查通道模式"),t.abrupt("return");case 39:for(h=0;h<u.length;h++)f=JSON.parse(JSON.stringify(this.nodeTree)),g=parseInt(1e4*Math.random()),f.id=f.id+g,f.label=f.label+g,f.style.width=Math.floor(u[h].width*d)+"px",f.style.height=Math.floor(u[h].height*d)+"px",f.style.left=Math.floor(u[h].left*d)+"px",f.style.top=Math.floor(u[h].top*d)+"px",f.props.url=u[h].src,p.push(f);this.content=p,this.loading=!1,this.open();case 43:case"end":return t.stop()}}),t,this,[[23,31]])})));function e(){return t.apply(this,arguments)}return e}(),dataURLtoFile:function(t,e){e||(e=Math.floor(1e4*Math.random())+".png"),t.startsWith("data:image/png;base64,")||(t="data:image/png;bases64,"+t),console.log();var n=t.split(","),i=n[0].match(/:(.*?);/)[1],a=window.atob(n[1]),o=a.length,s=new Uint8Array(o);while(o--)s[o]=a.charCodeAt(o);return new window.File([s],e,{type:i})},uploadOss:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e||(t=this.dataURLtoFile(t));var n=new window.FormData;return n.append("files",t),console.log("form",n),Object(c["a"])({url:"ossupload/uploadFile",method:"post",needLoading:!1,headers:{"Content-Type":"multipart/form-data"},data:n})},open:function(){var t=this;this.$confirm("文件解析成功, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("确定");var e={size:t.psdSize,name:t.psdName};console.log("this.content",t.content),t.changeNode(JSON.stringify(t.content),JSON.stringify(e)),t.close()})).catch((function(){}))}}},p=u,h=(n("e548"),n("2877")),f=Object(h["a"])(p,i,a,!1,null,"0eda570e",null);e["default"]=f.exports},e548:function(t,e,n){"use strict";n("36e1")}}]);